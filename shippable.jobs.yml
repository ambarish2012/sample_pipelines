jobs:
  - name: simple-mani-runCLISample
    type: manifest
    flags:
      - runCLISample
    steps:
      - IN: simple-image-runCLISample
      - IN: myParams-runCLISample

  - name: out-mani-runCLISample
    type: manifest
    flags:
      - runCLISample
    steps:
      - IN: simple-image-runCLISample

  - name: test-mani-runCLISample
    type: manifest
    flags:
      - runCLISample
    steps:
      - IN: testOutImage-runCLISample


  - name: simple-release-runCLISample
    type: release
    flags:
      - runCLISample
    steps:
      - IN: simple-mani-runCLISample
      - IN: simple-version-runCLISample
      - TASK: managed
        bump: patch

  - name: runCLIaws-runCLISample
    type: runCLI
    flags:
      - runCLISample
    steps:
      - IN: myConfig-runCLIsample
      - IN: dockerconfig-runCLIsample
      - TASK:
        - script: aws ec2 describe-vpcs
        - script: docker pull trriplejay/privateimg:latest
        - script: docker push trriplejay/privateimg:latest
    on_success:
      - script: aws ec2 describe-vpcs
      - script: docker push trriplejay/privateimg:latest
    on_failure:
      - script: aws ec2 describe-vpcs
      - script: docker push trriplejay/privateimg:latest
    always:
      - script: aws ec2 describe-vpcs
      - script: docker push trriplejay/privateimg:latest

  - name: runCLIecr-runCLISample
    type: runCLI
    flags:
      - runCLISample
    steps:
      - IN: dockerconfig-runCLIsample
      - IN: ecrconfig-runCLIsample
      - TASK:
        - script: aws ec2 describe-vpcs
        - script: docker pull 558099446733.dkr.ecr.us-west-2.amazonaws.com/trriplejay/privateimg:latest
        - script: docker push 558099446733.dkr.ecr.us-west-2.amazonaws.com/trriplejay/privateimg:latest
    on_success:
      - script: aws ec2 describe-vpcs
      - script: docker push 558099446733.dkr.ecr.us-west-2.amazonaws.com/trriplejay/privateimg:latest
    on_failure:
      - script: aws ec2 describe-vpcs
      - script: docker push 558099446733.dkr.ecr.us-west-2.amazonaws.com/trriplejay/privateimg:latest
    always:
      - script: aws ec2 describe-vpcs
      - script: docker push 558099446733.dkr.ecr.us-west-2.amazonaws.com/trriplejay/privateimg:latest

  - name: runShaws-runCLISample
    type: runSh
    flags:
      - runCLISample
    steps:
      - IN: runCLIaws-runCLISample
      - IN: runCLIecr-runCLISample
      - TASK:
        - script: aws ec2 describe-vpcs
    on_success:
      - script: aws ec2 describe-vpcs
    on_failure:
      - script: aws ec2 describe-vpcs
    always:
      - script: aws ec2 describe-vpcs

  - name: runShdocker-runCLISample
    type: runSh
    flags:
      - runCLISample
    steps:
      - IN: runCLIaws-runCLISample
      - TASK:
        - script: docker pull trriplejay/privateimg:latest
        - script: docker push trriplejay/privateimg:latest
    on_success:
      - script: docker push trriplejay/privateimg:latest
    on_failure:
      - script: docker push trriplejay/privateimg:latest
    always:
      - script: docker push trriplejay/privateimg:latest

  - name: runShecr-runCLISample
    type: runSh
    flags:
      - runCLISample
    steps:
      - IN: runCLIecr-runCLISample
      - TASK:
        - script: ls ~/.aws
        - script: cat ~/.docker/.dockercfg || true
        - script: docker pull 558099446733.dkr.ecr.us-west-2.amazonaws.com/trriplejay/privateimg:latest
        - script: docker push 558099446733.dkr.ecr.us-west-2.amazonaws.com/trriplejay/privateimg:latest
    on_success:
      - script: docker push 558099446733.dkr.ecr.us-west-2.amazonaws.com/trriplejay/privateimg:latest
    on_failure:
      - script: docker push 558099446733.dkr.ecr.us-west-2.amazonaws.com/trriplejay/privateimg:latest
    always:
      - script: docker push 558099446733.dkr.ecr.us-west-2.amazonaws.com/trriplejay/privateimg:latest

  - name: runShCheck-runCLISample
    type: runCLI
    flags:
      - runCLISample
    steps:
      - IN: stagingTrigger-runCLISample
      - IN: simple-release-runCLISample
      - IN: myConfig-runCLIsample
      - OUT: testOutImage-runCLISample
      - OUT: out-mani-runCLISample
      - TASK:
        - script: echo "resource ID is $RESOURCE_ID"
        - script: echo "versionName=$BUILD_NUMBER" > /build/state/testOutImage-runCLISample.env
        - script: echo "versionName=$BUILD_NUMBER" > /build/state/runShCheck-runCLISample.env
        - script: echo "extraProperty=$JOB_NAME" >> /build/state/testOutImage-runCLISample.env
        - script: sudo apt-get install -y jq
        - script: ls -latr /build/state
        - script: cat /build/state/testOutImage-runCLISample.env
        - script: cat /build/state/runShCheck-runCLISample.env
        - script: ls -latr /build/IN/simple-release-runCLISample/release
        - script: cat $RUNSHCHECKRUNCLISAMPLE_PATH/message.json | jq '.'
        - script: aws ec2 describe-vpcs

    on_failure:
      - script: echo "something failed"
    on_success:
      - script: echo "yay it worked"
